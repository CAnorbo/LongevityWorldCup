<!DOCTYPE html>
<html lang="en">
<head>
    <!--HEAD-->
    <style>
        /* Hide the join-game button in the header */
        .join-game {
            display: none;
        }

        /* Button Styles */
        .options-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 2rem;
        }

        .option-button {
            padding: 1rem 2rem;
            margin: 0.5rem 0;
            font-size: 1.2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 80%;
            max-width: 400px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

            .option-button:hover {
                background-color: var(--secondary-color);
                transform: scale(1.03);
            }

            .option-button.already-have {
                background-color: #4CAF50; /* Green */
            }

                .option-button.already-have:hover {
                    background-color: #388E3C; /* Darker Green */
                }

        /* Form Styles */
        .bioageform {
            max-width: 600px;
            margin: 2rem auto;
            padding: 1rem;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

            .bioageform label {
                display: block;
                margin-top: 1rem;
                font-weight: bold;
                color: #333;
            }

            .bioageform input,
            .bioageform select {
                width: 100%;
                padding: 0.5rem;
                margin-top: 0.5rem;
                box-sizing: border-box;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .bioageform {
                padding: 1rem;
            }

            .option-button {
                font-size: 1rem;
            }
        }

        /* Adjust the back button styling */
        .back-button {
            background-color: #607D8B;
        }

            .back-button:hover {
                background-color: #455A64;
            }

        #nationality {
            margin-bottom: 0; /* Reset any margin added here */
        }

        .bioageform {
            position: relative; /* Position relative to make dropdown align correctly */
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
            z-index: 9999;
            max-height: 150px; /* Limit height if needed */
            overflow-y: auto; /* Allow scrolling if the list is long */
            width: 100%; /* Make sure it matches the width of the container */
            top: 0; /* Keep this 0 because we are aligning relative to the input field */
            left: 0;
            margin-top: 0.5rem; /* Add a small margin to create separation */
        }
    </style>
</head>
<body>
    <!--HEADER-->
    <main>
        <!--MAIN-PROGRESS-BAR-->
        <h2>1. Character Creation</h2>
        <form id="personalInfoForm" class="bioageform">
            <div style="text-align: center;">
                <img src="../assets/reaper.jpg" alt="Grim Reaper" style="width: 100%; height: auto; max-width: 400px; display: block; margin: 0 auto 1.5rem; border: 4px solid #333; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); border-radius: 8px;">
            </div>
            <!--SUB-PROGRESS-BAR-->
            <p>
                In the shadows beyond our world, <strong>Death awaits</strong>, silent and relentless. It lurks at the edge of every breath, ready to claim its due.
                In these darkening times, we need a <strong>hero to rise</strong> — a mind sharp enough to craft a plan, a spirit bold enough to face the inevitable.
                Death will come — but who will stand in its path?<br />
                <em>Could it be you?</em>
            </p>
        </form>

        <form id="personalInfoForm" class="bioageform">
            <!-- Name Field -->
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required aria-required="true" placeholder="Real name or cyber alias — your call">

            <!-- Gender Field -->
            <label for="division">Division:</label>
            <select id="division" name="division" required aria-required="true">
                <!-- Options will be populated dynamically -->
            </select>

            <!-- Nationality Field with Autocomplete -->
            <label for="nationality">Flag:</label>
            <input type="text" id="nationality" name="nationality" required aria-required="true" autocomplete="off" placeholder="Cyberspace">
        </form>
        <div class="options-container">
            <button type="submit" class="option-button calculate-button already-have" aria-label="Proceed to the next stage">Next</button>
            <button class="option-button back-button" onclick="window.history.back()">Go Back</button>
        </div>
    </main>
    <!--FOOTER-->
    <!-- JavaScript -->
    <script>
        // Update the progress bar to the appropriate stage
        updateMainProgress(3);
        updateSubProgress(1);

        // Nationality Autocomplete Implementation
        document.addEventListener('DOMContentLoaded', function () {
            fetch('/api/data/flags')
                .then(response => response.json())
                .then(countries => {
                    const nationalityInput = document.getElementById('nationality');

                    nationalityInput.addEventListener('input', function () {
                        const inputVal = this.value.toLowerCase();
                        closeAllLists();
                        if (!inputVal) return false;

                        const listContainer = document.createElement('div');
                        listContainer.setAttribute('id', this.id + '-autocomplete-list');
                        listContainer.setAttribute('class', 'autocomplete-items');
                        this.parentNode.appendChild(listContainer);

                        let matchCount = 0;

                        for (let i = 0; i < countries.length; i++) {
                            if (countries[i].toLowerCase().startsWith(inputVal)) {
                                const listItem = document.createElement('div');
                                listItem.innerHTML = "<strong>" + countries[i].substr(0, inputVal.length) + "</strong>";
                                listItem.innerHTML += countries[i].substr(inputVal.length);
                                listItem.innerHTML += "<input type='hidden' value='" + countries[i] + "'>";
                                listItem.addEventListener('click', function () {
                                    nationalityInput.value = this.getElementsByTagName('input')[0].value;
                                    closeAllLists();
                                });
                                listContainer.appendChild(listItem);
                                matchCount++;
                                if (matchCount >= 5) break; // Limit to 5 suggestions
                            }
                        }
                    });

                    function closeAllLists(elmnt) {
                        const items = document.getElementsByClassName('autocomplete-items');
                        for (let i = 0; i < items.length; i++) {
                            if (elmnt != items[i] && elmnt != nationalityInput) {
                                items[i].parentNode.removeChild(items[i]);
                            }
                        }
                    }

                    document.addEventListener('click', function (e) {
                        closeAllLists(e.target);
                    });
                })
                .catch(error => {
                    console.error('Error fetching flags:', error);
                });
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Fetch flags and initialize nationality autocomplete
            fetch('/api/data/flags')
                .then(response => response.json())
                .then(countries => {
                    // Existing code for nationality autocomplete...
                })
                .catch(error => {
                    console.error('Error fetching flags:', error);
                });

            // Fetch divisions and populate the division select element
            fetch('/api/data/divisions')
                .then(response => response.json())
                .then(divisions => {
                    const divisionSelect = document.getElementById('division');

                    // Clear existing options (if any)
                    divisionSelect.innerHTML = '';

                    // Populate divisions into the select element
                    divisions.forEach(function (division) {
                        const option = document.createElement('option');
                        option.value = division.toLowerCase(); // Use lowercase or any appropriate value
                        option.textContent = division; // Display text as is
                        divisionSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching divisions:', error);
                });
        });

        // Form Submission Handler
        document.getElementById('personalInfoForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent form submission

            // Collect form data
            var name = document.getElementById('name').value.trim();
            var division = document.getElementById('division').value;
            var nationality = document.getElementById('nationality').value.trim();

            // Validate form data
            if (name && division && nationality) {
                // Store data in localStorage or proceed as needed
                localStorage.setItem('name', name);
                localStorage.setItem('division', division);
                localStorage.setItem('nationality', nationality);

                // Redirect to the next stage (replace 'nextstage.html' with the actual page)
                window.location.href = 'nextstage.html';
            } else {
                alert('Please fill in all required fields.');
            }
        });
    </script>
</body>
</html>