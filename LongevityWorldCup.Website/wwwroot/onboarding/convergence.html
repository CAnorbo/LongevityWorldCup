<!DOCTYPE html>
<html lang="en">
<head>
    <!--HEAD-->
    <link rel="stylesheet" href="https://unpkg.com/cropperjs@1.5.13/dist/cropper.min.css">
    <style>
        /* Hide the join-game button in the header */
        .join-game {
            display: none;
        }

        .option-button.already-have {
            background-color: #4CAF50; /* Green */
        }

            .option-button.already-have:hover {
                background-color: #388E3C; /* Darker Green */
            }

        /* Form Styles */
        .bioageform {
            max-width: 600px;
            margin: 2rem auto;
            padding: 1rem;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

            .bioageform label {
                display: block;
                margin-top: 1rem;
                font-weight: bold;
                color: #333;
            }

            .bioageform input,
            .bioageform select {
                width: 100%;
                padding: 0.5rem;
                margin-top: 0.5rem;
                box-sizing: border-box;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .bioageform {
                padding: 1rem;
            }

            .option-button {
                font-size: 1rem;
            }
        }

        #nationality {
            margin-bottom: 0; /* Reset any margin added here */
        }

        .bioageform {
            position: relative; /* Position relative to make dropdown align correctly */
        }

            .bioageform textarea {
                width: 100%;
                padding: 0.5rem;
                margin-top: 0.5rem;
                box-sizing: border-box;
                border: 1px solid #ccc;
                border-radius: 4px;
                resize: vertical; /* Allow users to resize vertically */
            }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
            z-index: 9999;
            max-height: 150px; /* Limit height if needed */
            overflow-y: auto; /* Allow scrolling if the list is long */
            width: 100%; /* Make sure it matches the width of the container */
            top: 0; /* Keep this 0 because we are aligning relative to the input field */
            left: 0;
            margin-top: 0.5rem; /* Add a small margin to create separation */
        }

        /* Add a new class for the pointer cursor */
        .clickable {
            cursor: pointer;
        }

        /* Style for the cropping image */
        #cropperImage {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        #proofImageContainer div {
            position: relative;
            display: inline-block;
            margin: 0.5rem;
        }

        #proofImageContainer img {
            max-width: 200px;
            border: 2px solid #333;
            border-radius: 8px;
        }

        #proofImageContainer button {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!--HEADER-->
    <main>
        <!--MAIN-PROGRESS-BAR-->
        <h2>1. Character Creation</h2>
        <form id="descriptionForm" class="bioageform">
            <div style="text-align: center;">
                <img src="../assets/reaper.jpg" alt="Grim Reaper" class="illustration" id="illustrationImage">
            </div>
            <!--SUB-PROGRESS-BAR-->
            <div id="content">
                In the shadows beyond our world, <strong>Death awaits</strong>, silent and relentless. It lurks at the edge of every breath, ready to claim its due.
                In these darkening times, we need a <strong>hero to rise</strong> — a mind sharp enough to craft a plan, a spirit bold enough to face the inevitable.
                Death will come — but who will stand in its path?<br />
                <em>Could it be you?</em>
            </div>
        </form>

        <form id="inputForm" class="bioageform">
            <div id="personalDetails">
                <!-- Name Field -->
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required aria-required="true" placeholder="Real name or cyber alias — your call">

                <!-- Division Field -->
                <label for="division">Division:</label>
                <select id="division" name="division" required aria-required="true">
                    <!-- Options will be populated dynamically -->
                </select>

                <!-- Nationality Field with Autocomplete -->
                <label for="nationality">Flag:</label>
                <input type="text" id="nationality" name="nationality" required aria-required="true" autocomplete="off" placeholder="Cyberspace">
            </div>

            <!-- New WHY Field (Initially Hidden) -->
            <div id="whyField" style="display: none;">
                <label for="why">What drives you forward?</label>
                <textarea id="why" name="why" rows="5"></textarea>
            </div>

            <!-- Proof Image Container -->
            <div id="proofImageContainer" style="text-align: center; margin-top: 1rem;"></div>

            <div class="options-container">
                <button type="button" class="option-button calculate-button already-have" id="nextButton" aria-label="Proceed to the next stage">Next</button>
                <button type="button" class="option-button back-button" id="backButton">Go Back</button>
            </div>
        </form>
    </main>
    <!--FOOTER-->
    <!-- JavaScript -->
    <script>
        var currentStage = 1;

        // Update the progress bar to the appropriate stage
        // Assuming updateMainProgress and updateSubProgress are defined elsewhere
        updateMainProgress(3);
        updateSubProgress(1);

        // Function to update the UI based on the current stage
        function goToStage(stage) {
            // Reset the illustrationImage to be clickable or not based on stage
            const illustrationImage = document.getElementById('illustrationImage');
            const nextButton = document.getElementById('nextButton');

            // Remove 'clickable' class initially
            illustrationImage.classList.remove('clickable');

            switch (stage) {
                case 1:
                    // Stage 1: Character Creation
                    document.querySelector('h2').textContent = "1. Character Creation";
                    illustrationImage.src = "../assets/reaper.jpg";
                    illustrationImage.alt = "Grim Reaper";
                    document.getElementById('content').innerHTML = `
                                                                                                                                                            In the shadows beyond our world, <strong>Death awaits</strong>, silent and relentless. It lurks at the edge of every breath, ready to claim its due.
                                                                                                                                                            In these darkening times, we need a <strong>hero to rise</strong> — a mind sharp enough to craft a plan, a spirit bold enough to face the inevitable.
                                                                                                                                                            Death will come — but who will stand in its path?<br />
                                                                                                                                                            <em>Could it be you?</em>
                                                                                                                                                        `;
                    document.getElementById('personalDetails').style.display = '';
                    document.getElementById('whyField').style.display = 'none';
                    document.getElementById('proofImageContainer').style.display = 'none';
                    nextButton.textContent = 'Next';
                    nextButton.setAttribute('type', 'button');
                    updateSubProgress(1);
                    break;
                case 2:
                    // Stage 2: Finding Your Why
                    document.querySelector('h2').textContent = "2. Finding Your Why";
                    illustrationImage.src = "../assets/why.jpg";
                    illustrationImage.alt = "Eye";
                    document.getElementById('content').innerHTML = `<p>He who has a <em>why</em> can bear almost any <em>how.</em></p>`;
                    document.getElementById('personalDetails').style.display = 'none';
                    document.getElementById('whyField').style.display = 'block';
                    nextButton.textContent = 'Next';
                    nextButton.setAttribute('type', 'button');
                    updateSubProgress(2);
                    break;
                case 3:
                    // Stage 3: The Price of Glory
                    document.querySelector('h2').textContent = "3. The Price of Glory";
                    illustrationImage.src = "../assets/cr7.jpg";
                    illustrationImage.alt = "Cristiano Ronaldo";
                    document.getElementById('content').innerHTML = `
                                                                                                                                                            <p style="text-align: center;"><strong>Privacy is your ability to selectively reveal yourself to the world.</strong></p>
                                                                                                                                                            <p>
                                                                                                                                                                Cristiano Ronaldo is one of the greatest football players of all time. Put yourself into his boots. You must work hard, of course, but your job doesn't end with honing your skills. You also need to display them in front of millions of people. <em>There’s no sport without spectators.</em>
                                                                                                                                                            </p>
                                                                                                                                                            <p>
                                                                                                                                                                So, does he lack privacy? <strong>No</strong>, he made a conscious decision to selectively reveal himself to the world.
                                                                                                                                                            </p>
                                                                                                                                                            <p>
                                                                                                                                                                <em>It's now your turn to make that decision.</em>
                                                                                                                                                            </p>
                                                                                                                                                        `;
                    document.getElementById('personalDetails').innerHTML = `
                                                                                                                                                            <p>Top-ranked longevity athletes will occasionally be asked to give an interview before their results are posted. Declining means no spot on the leaderboard. By proceeding, you agree to this.</p>
                                                                                                                                                            <p><em>Remember, we’re not gonna beat Death by hiding in the shadows.</em></p>
                                                                                                                                                        `;
                    // In the goToStage function, within case 3, replace the existing line with the following:
                    document.getElementById('whyField').style.display = 'none';
                    document.getElementById('personalDetails').style.display = '';
                    nextButton.textContent = 'Next';
                    nextButton.setAttribute('type', 'button');
                    updateSubProgress(3);
                    nextButton.textContent = 'Bring it on!';
                    break;
                case 4:
                    // Stage 4: Almost There
                    document.querySelector('h2').textContent = "4. Almost There";
                    illustrationImage.src = "../assets/headshot.jpg";
                    illustrationImage.alt = "Headshot";
                    document.getElementById('content').innerHTML = `<p>Next, provide your profile picture. Smiling is optional!</p>`;
                    document.getElementById('personalDetails').innerHTML = `
                                                                                                                                                            <p><strong>Upload a clear headshot:</strong></p>
                                                                                                                                                            <ol style="padding-left: 20px; line-height: 1.6;">
                                                                                                                                                                <li>It must be you.</li>
                                                                                                                                                                <li>Face the camera directly.</li>
                                                                                                                                                                <li>Include head and shoulders.</li>
                                                                                                                                                            </ol>
                                                                                                                                                            <div style="text-align: center; margin-top: 1rem;">
                                                                                                                                                                <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
                                                                                                                                                                <button type="button" id="uploadButton" class="option-button">Upload Profile Picture</button>
                                                                                                                                                            </div>
                                                                                                                                                        `;
                    illustrationImage.classList.add('clickable');
                    nextButton.textContent = 'Next';
                    nextButton.setAttribute('type', 'button');
                    updateSubProgress(4);

                    // Check if there is a stored profile picture and set it
                    const storedProfilePic = localStorage.getItem('profilePic');
                    if (storedProfilePic) {
                        illustrationImage.src = storedProfilePic;
                    }

                    // Attach event listeners for upload
                    attachUploadEventListeners();
                    break;
                case 5:
                    // Stage 5: Don't Trust Verify
                    document.querySelector('h2').textContent = "5. Don't Trust Verify";
                    illustrationImage.src = "../assets/proof.jpg";
                    illustrationImage.alt = "Proof Image";
                    document.getElementById('content').innerHTML = `
                                                                            <p>Upload <strong>image proofs</strong> of your biomarkers.</p>
                                                                            <p>These images will be <strong>public</strong>, so you're encouraged to censor any irrelevant information.</p>
                                                                        `;

                    document.getElementById('personalDetails').innerHTML = `
                                                                        <div style="display: flex; flex-direction: column; align-items: center; margin-top: 1rem;">
                                                                            <input type="file" id="proofPicInput" accept="image/*" style="display: none;" multiple>
                                                                            <button type="button" id="uploadProofButton" class="option-button">Upload Proof Images</button>
                                                                        </div>
                                                                    `;

                    illustrationImage.classList.remove('clickable');
                    nextButton.textContent = 'Next';
                    nextButton.setAttribute('type', 'button');
                    nextButton.classList.add("disabled-button");

                    // Attach event listener to the Upload Proof button
                    document.getElementById('uploadProofButton').addEventListener('click', function () {
                        document.getElementById('proofPicInput').click();
                    });

                    // Handle the image upload (without cropping)
                    document.getElementById('proofPicInput').addEventListener('change', function (event) {
                        const files = event.target.files;
                        if (files.length > 0) {
                            // Retrieve existing proof images from localStorage
                            let proofPics = JSON.parse(localStorage.getItem('proofPics')) || [];

                            // Limit the total number of images to 9
                            if (proofPics.length + files.length > 9) {
                                alert('You can upload a maximum of 9 images.');
                                return;
                            }

                            for (let i = 0; i < files.length; i++) {
                                const file = files[i];
                                const reader = new FileReader();
                                reader.onload = function (e) {
                                    proofPics.push(e.target.result);
                                    // Store the updated proofPics array
                                    localStorage.setItem('proofPics', JSON.stringify(proofPics));
                                    // Update the display
                                    updateProofImageContainer();
                                };
                                reader.readAsDataURL(file);
                            }
                        }
                        // Reset the file input's value to allow re-uploading the same file if needed
                        document.getElementById('proofPicInput').value = "";
                    });

                    document.getElementById('proofImageContainer').style.display = 'block';

                    // Display any existing proof images
                    updateProofImageContainer();

                    break;
                case 6:
                    // Stage 6: Final Details
                    document.querySelector('h2').textContent = "6. Final Details";
                    illustrationImage.src = "../assets/finish.jpg";
                    illustrationImage.alt = "Finish Line";
                    document.getElementById('content').innerHTML = "<p style='text-align: center; font-weight: bold;'>Final Details</p>";
                    document.getElementById('personalDetails').innerHTML = `
                                                                                                                                                            <!-- Link to Personal Page (Optional) -->
                                                                                                                                                            <label for="personalLink">Link (Optional):</label>
                                                                                                                                                            <input type="url" id="personalLink" name="personalLink" placeholder="https://yourwebsite.com">
                                                                                                                                                            <p style="margin-top: 0.5rem; color: #555;">
                                                                                                                                                                Provide a link to your personal page, social media profile, or any other online presence you wish to advertise.
                                                                                                                                                            </p>

                                                                                                                                                            <!-- Media Contact (Required) -->
                                                                                                                                                            <label for="mediaContact">Media Contact:</label>
                                                                                                                                                            <input type="email" id="mediaContact" name="mediaContact" required aria-required="true" placeholder="media@youremail.com">

                                                                                                                                                            <p style="margin-top: 0.5rem; color: #555;">
                                                                                                                                                                Please provide a media contact email. Be cautious about using your personal email address. It is recommended to create a dedicated email (e.g.: <a href="https://protonmail.com" target="_blank">ProtonMail</a>) or use a social media account like Instagram or Twitter if your messages are open.
                                                                                                                                                            </p>
                                                                                                                                                        `;

                    document.getElementById('proofImageContainer').style.display = 'none';
                    illustrationImage.classList.remove('clickable');
                    nextButton.textContent = 'Next';
                    nextButton.setAttribute('type', 'button');
                    break;
                case 7:
                    // Stage 7: Application
                    document.querySelector('h2').textContent = "5. Application";
                    illustrationImage.src = "../assets/account-creation.jpg";
                    illustrationImage.alt = "Application";
                    document.getElementById('content').innerHTML = "<p>Congrats! All that's left to do is to provide your contact email.</p>";
                    document.getElementById('personalDetails').innerHTML = `
                                                                                                                                                            <!-- Email Field -->
                                                                                                                                                            <label for="accountEmail">Email:</label>
                                                                                                                                                            <input type="email" id="accountEmail" name="accountEmail" required aria-required="true" placeholder="yourname@example.com">
                                                                                                                                                        `;
                    illustrationImage.classList.remove('clickable');
                    nextButton.textContent = 'Apply';
                    nextButton.setAttribute('type', 'submit');
                    updateSubProgress(5);
                    break;
                default:
                    console.error('Unknown stage:', stage);
            }
        }

        // Nationality Autocomplete Implementation
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize the first stage
            goToStage(currentStage);

            fetch('/api/data/flags')
                .then(response => response.json())
                .then(countries => {
                    const nationalityInput = document.getElementById('nationality');

                    nationalityInput.addEventListener('input', function () {
                        const inputVal = this.value.toLowerCase();
                        closeAllLists();
                        if (!inputVal) return false;

                        const listContainer = document.createElement('div');
                        listContainer.setAttribute('id', this.id + '-autocomplete-list');
                        listContainer.setAttribute('class', 'autocomplete-items');
                        this.parentNode.appendChild(listContainer);

                        let matchCount = 0;

                        for (let i = 0; i < countries.length; i++) {
                            if (countries[i].toLowerCase().startsWith(inputVal)) {
                                const listItem = document.createElement('div');
                                listItem.innerHTML = "<strong>" + countries[i].substr(0, inputVal.length) + "</strong>";
                                listItem.innerHTML += countries[i].substr(inputVal.length);
                                listItem.innerHTML += "<input type='hidden' value='" + countries[i] + "'>";
                                listItem.addEventListener('click', function () {
                                    nationalityInput.value = this.getElementsByTagName('input')[0].value;
                                    closeAllLists();
                                });
                                listContainer.appendChild(listItem);
                                matchCount++;
                                if (matchCount >= 5) break; // Limit to 5 suggestions
                            }
                        }
                    });

                    function closeAllLists(elmnt) {
                        const items = document.getElementsByClassName('autocomplete-items');
                        for (let i = 0; i < items.length; i++) {
                            if (elmnt != items[i] && elmnt != nationalityInput) {
                                items[i].parentNode.removeChild(items[i]);
                            }
                        }
                    }

                    document.addEventListener('click', function (e) {
                        closeAllLists(e.target);
                    });
                })
                .catch(error => {
                    console.error('Error fetching flags:', error);
                });

            // Fetch divisions and populate the division select element
            fetch('/api/data/divisions')
                .then(response => response.json())
                .then(divisions => {
                    const divisionSelect = document.getElementById('division');

                    // Clear existing options (if any)
                    divisionSelect.innerHTML = '';

                    // Populate divisions into the select element
                    divisions.forEach(function (division) {
                        const option = document.createElement('option');
                        option.value = division.toLowerCase(); // Use lowercase or any appropriate value
                        option.textContent = division; // Display text as is
                        divisionSelect.appendChild(option);
                    });

                    // Optionally, set a default value or prompt
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = '-- Select Division --';
                    defaultOption.disabled = true;
                    defaultOption.selected = true;
                    divisionSelect.insertBefore(defaultOption, divisionSelect.firstChild);
                })
                .catch(error => {
                    console.error('Error fetching divisions:', error);
                });
        });

        // Form Submission Handler
        document.getElementById('inputForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent form submission

            // Collect form data based on current stage
            let isValid = true;
            let formData = {};

            if (currentStage >= 1 && currentStage <= 2) {
                // Stage 1 and 2 require name, division, nationality, and why
                const name = document.getElementById('name').value.trim();
                const division = document.getElementById('division').value;
                const nationality = document.getElementById('nationality').value.trim();
                const why = document.getElementById('why').value.trim();

                if (!name || !division || !nationality || !why) {
                    isValid = false;
                } else {
                    formData = { name, division, nationality, why };
                }
            }

            if (currentStage === 7) {
                // Final stage requires accountEmail
                const accountEmail = document.getElementById('accountEmail').value.trim();
                if (!accountEmail) {
                    isValid = false;
                } else {
                    formData.accountEmail = accountEmail;
                }
            }

            // Additional validation can be added here for other stages

            if (isValid) {
                // Store data in localStorage or proceed as needed
                for (const key in formData) {
                    localStorage.setItem(key, formData[key]);
                }

                if (currentStage === 7) {
                    // Proceed to final submission or next steps
                    alert('Account created successfully!');
                    // You can redirect the user or perform other actions here
                    window.location.href = 'onboarding/application-review.html';
                } else {
                    // Navigate to the next stage if not on the final stage
                    document.getElementById('nextButton').click();
                }
            } else {
                alert('Please fill in all required fields.');
            }
        });

        // "Next" Button Click Event Handler
        document.getElementById('nextButton').addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default button action

            // Scroll the heading into view
            document.querySelector('h2').scrollIntoView({ behavior: 'smooth' });

            // Remove the 'clickable' class from the illustrationImage
            document.getElementById('illustrationImage').classList.remove('clickable');

            if (currentStage < 7) {
                currentStage++;
                goToStage(currentStage);
            } else {
                // This is the final stage
                window.location.href = 'onboarding/application-review.html';
            }
        });

        // "Go Back" Button Click Event Handler
        document.getElementById('backButton').addEventListener('click', function () {
            if (currentStage > 1) {
                currentStage--;
                goToStage(currentStage);
            } else {
                // If on the first stage, go back to the previous page
                window.history.back();
            }
        });

        function attachUploadEventListeners() {
            // Set up event listener for the upload button
            const uploadButton = document.getElementById('uploadButton');
            if (uploadButton && !uploadButton.hasAttribute('data-listener')) {
                uploadButton.addEventListener('click', function () {
                    document.getElementById('profilePicInput').click();
                });
                uploadButton.setAttribute('data-listener', 'true');
            }

            // Add click event to the image to trigger file selection
            const illustrationImage = document.getElementById('illustrationImage');
            if (illustrationImage && !illustrationImage.hasAttribute('data-listener')) {
                illustrationImage.addEventListener('click', function () {
                    document.getElementById('profilePicInput').click();
                });
                illustrationImage.setAttribute('data-listener', 'true');
            }

            // Handle the image upload and initialize Cropper.js
            const profilePicInput = document.getElementById('profilePicInput');
            if (profilePicInput && !profilePicInput.hasAttribute('data-listener')) {
                profilePicInput.addEventListener('change', function (event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            // Create an image element for cropping
                            const cropperImage = document.createElement('img');
                            cropperImage.id = 'cropperImage';
                            cropperImage.src = e.target.result;

                            // Clear the current content and insert the image
                            document.getElementById('personalDetails').innerHTML = '';
                            document.getElementById('personalDetails').appendChild(cropperImage);

                            // Initialize Cropper.js on the image
                            const cropper = new Cropper(cropperImage, {
                                aspectRatio: 1024 / 768, // Set the aspect ratio
                                viewMode: 1,
                                autoCropArea: 1,
                                movable: true,
                                zoomable: true,
                                rotatable: false,
                                scalable: false,
                                cropBoxResizable: true,
                                minCropBoxWidth: 200,
                                minCropBoxHeight: 150,
                            });

                            // Add a "Crop and Save" button
                            const cropButton = document.createElement('button');
                            cropButton.textContent = 'Crop and Save';
                            cropButton.className = 'option-button';
                            cropButton.style.marginTop = '1rem';
                            document.getElementById('personalDetails').appendChild(cropButton);

                            // Handle the crop button click
                            cropButton.addEventListener('click', function () {
                                const croppedCanvas = cropper.getCroppedCanvas({
                                    width: 1024,
                                    height: 768,
                                });
                                const croppedImageDataURL = croppedCanvas.toDataURL('image/png');

                                // Set the cropped image as the illustration image
                                document.getElementById('illustrationImage').src = croppedImageDataURL;

                                // Store the cropped image in localStorage
                                localStorage.setItem('profilePic', croppedImageDataURL);

                                // Remove the cropper instance and restore the content
                                cropper.destroy();
                                document.getElementById('personalDetails').innerHTML = `
                                                                                                                                                                        <p><strong>Upload a clear headshot:</strong></p>
                                                                                                                                                                        <ol style="padding-left: 20px; line-height: 1.6;">
                                                                                                                                                                            <li>It must be you.</li>
                                                                                                                                                                            <li>Face the camera directly.</li>
                                                                                                                                                                            <li>Include head and shoulders.</li>
                                                                                                                                                                        </ol>
                                                                                                                                                                        <div style="text-align: center; margin-top: 1rem;">
                                                                                                                                                                            <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
                                                                                                                                                                            <button type="button" id="uploadButton" class="option-button">Upload Profile Picture</button>
                                                                                                                                                                        </div>
                                                                                                                                                                    `;
                                // Re-attach event listeners to the new elements
                                attachUploadEventListeners();
                            });
                        };
                        reader.readAsDataURL(file);
                    }
                });
                profilePicInput.setAttribute('data-listener', 'true');
            }
        }

        function updateProofImageContainer() {
            let container = document.getElementById('proofImageContainer');
            container.innerHTML = '';
            // Retrieve existing proof images from localStorage
            let proofPics = JSON.parse(localStorage.getItem('proofPics')) || [];
            if (proofPics.length > 0) {
                container.innerHTML = '<p><strong>Proof uploaded successfully.</strong></p>';
                for (let i = 0; i < proofPics.length; i++) {
                    let imgContainer = document.createElement('div');
                    imgContainer.style = 'position: relative; display: inline-block; margin: 0.5rem;';

                    let img = document.createElement('img');
                    img.src = proofPics[i];
                    img.alt = 'Proof Image ' + (i + 1);
                    img.style = 'max-width: 100%; border: 2px solid #333; border-radius: 8px;';

                    let removeButton = document.createElement('button');
                    removeButton.textContent = 'Remove';
                    removeButton.style = 'position: absolute; top: 5px; right: 5px; background-color: rgba(255, 0, 0, 0.7); color: white; border: none; border-radius: 3px; cursor: pointer;';
                    removeButton.addEventListener('click', function () {
                        proofPics.splice(i, 1);
                        localStorage.setItem('proofPics', JSON.stringify(proofPics));
                        updateProofImageContainer();
                    });

                    imgContainer.appendChild(img);
                    imgContainer.appendChild(removeButton);
                    container.appendChild(imgContainer);
                }
            }
        }
    </script>
    <script src="https://unpkg.com/cropperjs@1.5.13/dist/cropper.min.js"></script>
</body>
</html>